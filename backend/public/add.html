<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add story</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .nav-menu {
        z-index: 9999; /* Ensure a high z-index value */
        display: none; /* Initially hidden */
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="bg-gray-100 font-sans w-full m-0">
        <div class="bg-white shadow">
          <div class="container mx-auto px-4 h-full">
            <div class="flex items-center justify-between py-4">
              <div class="flex items-center">
                <img
                  src="../assets/images/deeStories.jpg"
                  class="w-20 h-20"
                  alt=""
                />
                <h1 class="font-medium text-sm">
                  <a href="/">Dee Stories Api</a>
                </h1>
              </div>
              <div class="hidden md:flex md:items-center">
                <a
                  href="/"
                  class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4"
                  >Dashboard</a
                >
                <a
                  href="./public.html"
                  class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4"
                  >Public</a
                >
              </div>
              <div class="hidden md:flex md:items-center">
                <h2
                  class="user text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4"
                ></h2>
                <a
                  href="./login.html"
                  class="user-in text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4"
                  >Sign in</a
                >
                <a
                  href="/auth/logout"
                  class="user-out text-sm font-semibold border px-4 py-2 rounded-lg hover:text-purple-600 hover:border-purple-600"
                  >Log Out</a
                >
              </div>
              <div class="hamburger-menu md:hidden cursor-pointer">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-12 h-10 text-gray-400"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="currentColor"
                    d="M12.9499909,17 C12.7183558,18.1411202 11.709479,19 10.5,19 C9.29052104,19 8.28164422,18.1411202 8.05000906,17 L3.5,17 C3.22385763,17 3,16.7761424 3,16.5 C3,16.2238576 3.22385763,16 3.5,16 L8.05000906,16 C8.28164422,14.8588798 9.29052104,14 10.5,14 C11.709479,14 12.7183558,14.8588798 12.9499909,16 L20.5,16 C20.7761424,16 21,16.2238576 21,16.5 C21,16.7761424 20.7761424,17 20.5,17 L12.9499909,17 Z M18.9499909,12 C18.7183558,13.1411202 17.709479,14 16.5,14 C15.290521,14 14.2816442,13.1411202 14.0500091,12 L3.5,12 C3.22385763,12 3,11.7761424 3,11.5 C3,11.2238576 3.22385763,11 3.5,11 L14.0500091,11 C14.2816442,9.85887984 15.290521,9 16.5,9 C17.709479,9 18.7183558,9.85887984 18.9499909,11 L20.5,11 C20.7761424,11 21,11.2238576 21,11.5 C21,11.7761424 20.7761424,12 20.5,12 L18.9499909,12 Z M9.94999094,7 C9.71835578,8.14112016 8.70947896,9 7.5,9 C6.29052104,9 5.28164422,8.14112016 5.05000906,7 L3.5,7 C3.22385763,7 3,6.77614237 3,6.5 C3,6.22385763 3.22385763,6 3.5,6 L5.05000906,6 C5.28164422,4.85887984 6.29052104,4 7.5,4 C8.70947896,4 9.71835578,4.85887984 9.94999094,6 L20.5,6 C20.7761424,6 21,6.22385763 21,6.5 C21,6.77614237 20.7761424,7 20.5,7 L9.94999094,7 Z M7.5,8 C8.32842712,8 9,7.32842712 9,6.5 C9,5.67157288 8.32842712,5 7.5,5 C6.67157288,5 6,5.67157288 6,6.5 C6,7.32842712 6.67157288,8 7.5,8 Z M16.5,13 C17.3284271,13 18,12.3284271 18,11.5 C18,10.6715729 17.3284271,10 16.5,10 C15.6715729,10 15,10.6715729 15,11.5 C15,12.3284271 15.6715729,13 16.5,13 Z M10.5,18 C11.3284271,18 12,17.3284271 12,16.5 C12,15.6715729 11.3284271,15 10.5,15 C9.67157288,15 9,15.6715729 9,16.5 C9,17.3284271 9.67157288,18 10.5,18 Z"
                  />
                </svg>
              </div>
            </div>

            <!-- mobile menu -->
            <div
              class="nav-menu hidden bg-gray-400 absolute right-0 top-0 w-[60%] h-full border-t-2 py-2"
            >
              <div class="block">
                <div
                  class="flex item-center mt-4 border-t-2 border-b-2 justify-center text-white py-1 px-4 ml-5 rounded-lg max-w-[20%] text-[30px]"
                >
                  <h2 id="close-menu">></h2>
                </div>
                <div
                  class="mt-[50px] mx-[40px] flex flex-wrap justify-center item-center w-[70%]"
                >
                  <a
                    href="/"
                    class="text-white text-[40px] mt-[30px] font-semibold hover:text-purple-600 mr-4"
                    >Dashboard</a
                  >
                  <a
                    href="./public.html"
                    class="text-white text-[40px] mt-[30px] font-semibold hover:text-purple-600 mr-4"
                    >Public</a
                  >
                </div>
                <div
                  class="flex justify-between items-center absolute bottom-4 ml-4 pt-2"
                >
                  <h2
                    class="user text-white text-md font-semibold hover:text-purple-600 mr-4"
                  ></h2>
                  <a
                    href="./login.html"
                    class="user-in text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4"
                    >Sign in</a
                  >
                  <a
                    href="/auth/logout"
                    class="user-out text-white text-md font-semibold border-2 px-4 py-2 rounded-lg hover:text-purple-600 hover:border-purple-600"
                    >Log Out</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="flex flex-wrap justify-center items-center mt-6">
      <h3 class="text-[40px] mb-4 w-[65%]">Add Story</h3>
      <form
        action="/stories"
        method="POST"
        class="w-[80%]"
        id="storyForm"
        enctype="multipart/form-data"
      >
        <div class="relative mb-6">
          <label for="title" class="text-[20px]">Title:</label>
          <input
            type="text"
            id="title"
            name="title"
            class="w-full p-3 border-b border-gray-300 focus:border-green-500 focus:outline-none placeholder-transparent"
            placeholder=" "
          />

          <label
            for="uploadFile1"
            class="bg-white mt-5 text-gray-500 font-semibold text-base rounded max-w-md h-52 flex flex-col items-center justify-center cursor-pointer border-2 border-gray-300 border-dashed mx-auto font-[sans-serif]"
          >
            <div id="svg" class="flex flex-col items-center justify-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-11 mb-2 fill-gray-500"
                viewBox="0 0 32 32"
              >
                <path
                  d="M23.75 11.044a7.99 7.99 0 0 0-15.5-.009A8 8 0 0 0 9 27h3a1 1 0 0 0 0-2H9a6 6 0 0 1-.035-12 1.038 1.038 0 0 0 1.1-.854 5.991 5.991 0 0 1 11.862 0A1.08 1.08 0 0 0 23 13a6 6 0 0 1 0 12h-3a1 1 0 0 0 0 2h3a8 8 0 0 0 .75-15.956z"
                  data-original="#000000"
                />
                <path
                  d="M20.293 19.707a1 1 0 0 0 1.414-1.414l-5-5a1 1 0 0 0-1.414 0l-5 5a1 1 0 0 0 1.414 1.414L15 16.414V29a1 1 0 0 0 2 0V16.414z"
                  data-original="#000000"
                />
              </svg>
              Upload file
            </div>
            <img id="imagePreview" class="hidden w-20 h-20 object-cover mb-2" />
            <span
              id="fileName"
              class="text-xs font-medium text-gray-400 mt-2"
            ></span>

            <input type="file" id="uploadFile1" class="hidden" name="image" />
            <p class="text-xs font-medium text-gray-400 mt-2" id="pic">
              PNG, JPG SVG, WEBP, and GIF are Allowed.
            </p>
          </label>
        </div>

        <div class="flex w-full">
          <div class="relative mb-6">
            <select
              id="status"
              name="status"
              class="mt-5 w-full p-3 border-b border-gray-300 focus:border-green-500 focus:outline-none"
            >
              <option value="public" selected>Public</option>
              <option value="private">Private</option>
            </select>
          </div>

          <div id="genres" class="flex flex-wrap w-[45%] ml-5 h-[49px] cursor-text mt-5 p-5 border-b border-gray-300 focus-within:border-green-500">
            <div id="genreInput" class="flex-1 min-w-[100px] outline-none flex-1 min-w-[100px] outline-none" contenteditable="true"></div>
            <input type="hidden" id="genresInput" />
          </div>
          
          <div class="mx-5">
            <input
              type="text"
              id="chapter"
              name="chapter"
              class="w-full border-b p-5 h-[49px] mt-5 border-gray-300 focus:border-green-500 focus:outline-none"
              placeholder="Chapter"
            />
          </div>
        </div>
        <div class="mb-6">
          <label for="body" class="block text-[20px] mb-2"
            >Tell Us Your Story:</label
          >
          <textarea
            id="body"
            name="body"
            class="w-full border border-gray-300 focus:border-green-500 focus:outline-none rounded-lg"
          ></textarea>
        </div>

        <div class="flex">
          <input
            type="submit"
            value="Save"
            class="bg-green-300 text-white px-4 py-2 mr-5"
          />
          <a href="/dashboard" class="bg-orange-300 text-white px-4 py-2 mr-5"
            >Cancel</a
          >
        </div>
      </form>
    </div>
    <script src="https://cdn.ckeditor.com/ckeditor5/41.3.1/classic/ckeditor.js"></script>

    <script>
      ClassicEditor.create(document.querySelector("#body")).catch((error) => {
        console.error(error);
      });
    </script>

    <!-- image upload -->
    <script>
      document
        .getElementById("uploadFile1")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          const reader = new FileReader();

          reader.onload = function (e) {
            const preview = document.getElementById("imagePreview");
            const svg = document.getElementById("svg");
            const pic = document.getElementById("pic");

            preview.src = e.target.result;
            preview.classList.remove("hidden");

            svg.className = "hidden";
            pic.className = "hidden";

            const fileName = document.getElementById("fileName");
            fileName.textContent = file.name;
          };

          if (file) {
            reader.readAsDataURL(file);
          }
        });
    </script>

<!-- genre list -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const genreInput = document.getElementById('genreInput');
    const genresInput = document.getElementById('genresInput');
    const genres = document.getElementById('genres');
    const placeholder = document.getElementById('placeholder');


    genreInput.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && genreInput.textContent.trim() !== '') {
        event.preventDefault();
        addGenreItem(genreInput.textContent.trim());
        genreInput.textContent = '';
        updateGenresInput();
      }
    });

    function addGenreItem(genre) {
      const genreItem = document.createElement('div');
      genreItem.className = 'inline-flex items-center bg-gray-200 rounded-full py-1 px-3 m-1 text-sm';

      const genreText = document.createElement('span');
      genreText.textContent = genre;
      genreText.className = 'mr-2'

      const removeButton = document.createElement('button');
      removeButton.innerHTML = '&times;';
      removeButton.className = 'bg-none border-none text-gray-600 cursor-pointer'
      removeButton.addEventListener('click', function() {
        genreItem.remove();
        updateGenresInput();
      });

      const hiddenInput = document.createElement('input')
      hiddenInput.type = 'hidden';
      hiddenInput.name = 'genre';
      hiddenInput.value = genre;

      genres.appendChild(hiddenInput)

      genreItem.appendChild(genreText);
      genreItem.appendChild(removeButton);
      genreInput.insertAdjacentElement('beforebegin', genreItem);
    }

    function updateGenresInput() {
      const genres = Array.from(document.querySelectorAll('.genre-item span')).map(span => span.textContent);
      genresInput.value = genres;
    }
    function togglePlaceholder() {
      if (genreInput.textContent.trim() === '' && !document.querySelector('.genre-item')) {
        placeholder.style.display = 'block';
      } else {
        placeholder.style.display = 'none';
      }
    }

    togglePlaceholder();
  });
</script>


    <script src="../functions/user.js"></script>
    <script src="../functions/addUser.js"></script>
  </body>
</html>
